<!DOCTYPE html>
<html>
	<title>Mix Dj Titanium</title>
	<head>
		<link href="css/estilos.css" rel="stylesheet" type="text/css" />
		<link href="css/jquery.nouislider.css" rel="stylesheet" type="text/css" >
		<link href="css/uploadfile.css" rel="stylesheet" type="text/css" >
		<link rel="stylesheet" href="css/jquery.equalizer.css" />
		<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/jquery.reverseorder.js"></script>
		<script type="text/javascript" src="js/jquery.equalizer.js"></script>
		<script type="text/javascript" src="js/jquery.nouislider.js"></script>
		<script type="text/javascript" src="js/jquery.uploadfile.min.js"></script>
		<script type="text/javascript" src="js/javascript.js"></script>
	</head>
	<body class="body">
		<audio id="som1" ontimeupdate="updateTime('som1', 'tempo1')" src="musicas/jenovaDrums.wav" type="audio/mp3"></audio>
		<div id="logo"></div>
		<div id="main">
			<div id="esquerda">
				<div id="carregarFicheiros"></div>
				<div id="musicas"></div>
			</div>
			<div id="direita">
				<div id="master">
					<span id="playG" onclick="playAll('nome')"></span>
					<span id="pauseG" onclick="pauseAll('nome')"></span>
					<span id="stopG" onclick="stopAll('nome')"></span>
				</div>
				<div id="masterL"></div>
				<div id="trackList">
					<div class="audioContainer" id="audioC1" ondrop="drop('audioC1',event)" ondragover="allowDrop(event)">
						<div class="containerUm">
							<div class="titulo">
								<div class="nome">
									Musica 1.mp3
								</div>
								<div class="tempoC" id="tempo1">
									0:00/0:00
								</div>
								<div class="loop" id="loop1" onclick="repeat('som'+i, 'loop'+i);"></div>
							</div>
							<div class="seekContainer">
								<div class="wrapper">
									<div class="seek" id="seek1"></div>
									<div class="trim" id="trim1"></div>
								</div>
								<div class="play" id="play1" onclick="playPause('som'+i, 'play'+i);"></div>
							</div>
							<div class="trimContainer">
								<div class="stop" onclick="stopmusica('som'+i, 'play'+i);"></div>
							</div>
						</div>
						<div class="containerDois"></div>
						<div class="containerTres">
							<div class="mute" id="mute1" onclick="silencio('som'+i,'mute'+i);"></div>
							<div class="checkbox">
								<input type="checkbox" id="checkbox1">
								<label for="checkbox1"></label>
							</div>
							<div class="remove" onclick="removeAudio(this,'som'+i);"></div>
							<div class="volumeMenos"></div>
							<div class="volume" id="volume1"></div>
							<div class="volumeMais"></div>
						</div>
					</div>
					<!--div class="audioContainer" id="audioC1" ondrop="drop('audioC1',event)" ondragover="allowDrop(event)"></div-->
					<div class="audioContainer" id="audioC2" ondrop="drop('audioC2',event)" ondragover="allowDrop(event)"></div>
					<div class="audioContainer" id="audioC3" ondrop="drop('audioC3',event)" ondragover="allowDrop(event)"></div>
					<div class="audioContainer" id="audioC4" ondrop="drop('audioC4',event)" ondragover="allowDrop(event)"></div>
					<div class="audioContainer" id="audioC5" ondrop="drop('audioC5',event)" ondragover="allowDrop(event)"></div>
					<div class="audioContainer" id="audioC6" ondrop="drop('audioC6',event)" ondragover="allowDrop(event)"></div>
					<div class="audioContainer" id="audioC7" ondrop="drop('audioC7',event)" ondragover="allowDrop(event)"></div>
					<div class="audioContainer" id="audioC8" ondrop="drop('audioC8',event)" ondragover="allowDrop(event)"></div>
				</div>
			</div>
		</div>
	</body>
</html>

<script>
	var i = 1;
	$(function() {
		var som = document.getElementById('som1');
		var icon = document.getElementById('play1');
		var sliderSeek = $('#seek1');
		var sliderTrim = $('#trim1');
		var sliderVolume = $('#volume1');
		var aux = [0, 100];
		aux[0] = som.duration * (aux[0] / 100);
		aux[1] = som.duration * (aux[1] / 100);

		sliderSeek.noUiSlider({
			range : [0, 100],
			start : 0,
			handles : 1,
			connect : false,
			slide : function() {
				som.pause();
			}
		}).change(function() {
			som.play();
			var time = som.duration * (sliderSeek.val() / 100);
			som.currentTime = time;
			if(som.currentTime < aux[0]){som.currentTime = aux[0];}
		});

		som.addEventListener("timeupdate", function() {
			var value = (100 / som.duration) * som.currentTime;
			sliderSeek.val(value);
			if (som.loop == true) {
				if (som.currentTime >= aux[1]) {
					som.currentTime = aux[0];
				};
			} 
			else {
				if (som.currentTime >= aux[1] || som.ended) {
					som.currentTime = aux[0];
					som.pause();
					icon.setAttribute("style", "background-image:url(imgs/play.png);");
				};
			};
		});

		//var end = 0;
		//
		//
		//teste.addEventListener('ontimeupdate', function(ev) {
		//  if (teste.currentTime > end) {
		//    teste.pause();
		//    }
		//},false);
		//
		//function playSpecial(){
		//    teste.currentTime = 0;
		//    end = 1;
		//    teste.play();
		//}

		sliderTrim.noUiSlider({
			range : [0, 100],
			start : [0, 100],
			handles : 2,
			connect : true,
			behaviour : 'tap-drag'
		}).change(function() {
			aux = sliderTrim.val();
			aux[0] = som.duration * (aux[0] / 100);
			aux[1] = som.duration * (aux[1] / 100);
			som.currentTime = aux[0];
		});

		sliderVolume.noUiSlider({
			range : [0, 100],
			start : 100,
			handles : 1,
			connect : "lower",
			behaviour : 'tap'
		}).change(function() {
			var volume = sliderVolume.val() / 100;
			som.volume = volume;
		});

		som.addEventListener("volumechange", function() {
			sliderVolume.val(som.volume * 100);
		});
	});

</script>